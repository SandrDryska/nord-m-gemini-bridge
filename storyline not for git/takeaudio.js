// --- Полный скрипт для триггера в Storyline (отправка всем iframe) ---

// 1. ФОРМИРОВАНИЕ ПРОМПТА
const finalPrompt = `
Ты — опытный HR-эксперт и коуч по менеджменту. Твоя задача — оценить ответ руководителя, который готовится к разговору с сотрудником.

---
КОНТЕКСТ СИТУАЦИИ:
Ваш сотрудник выполняет работу некачественно. Он знает, как нужно делать, но то тут не доделает, то сделает плохо. Когда вы ему говорите о том, что что-то сделано не так, он просто исправляет. Вы хотите поговорить с сотрудником, чтоб изменить его отношение к работе.

---
ТЕОРЕТИЧЕСКАЯ БАЗА ДЛЯ ОЦЕНКИ:
- План разговора: цель, позитив, ситуация, самооценка, своя оценка, выводы, рекомендации.
- Правила: оценка действий, конкретика, вовлечение, честность, план действий.
- НЕ "БУТЕРБРОД": Начало с позитива для установления контакта — это правильно. Не путай это с "бутербродом".

---
ОТВЕТ РУКОВОДИТЕЛЯ ДЛЯ ОЦЕНКИ:
[Далее следует голосовое сообщение от руководителя]

---
ТВОЯ ЗАДАЧА:
Проанализируй голосовое сообщение от руководителя. Твой ответ ДОЛЖЕН БЫТЬ СТРОГО В ФОРМАТЕ JSON.
Не добавляй никаких пояснений до или после JSON. Только валидный JSON-объект.

Структура JSON должна быть следующей:
{
  "overall": "Твой общий вывод в одном предложении",
  "goodPoints": [
    "Первый положительный момент",
    "Второй положительный момент"
  ],
  "improvementPoints": [
    "Первый пункт, что можно улучшить",
    "Второй пункт, что можно улучшить"
  ]
}

- В "goodPoints" перечисли, какие шаги и правила из теории были соблюдены.
- В "improvementPoints" перечисли, какие шаги и правила упущены. Если все хорошо, верни пустой массив [].
- Говори на "ты" с руководителем.
`;

// 2. ПОИСК ВСЕХ ВЕБ-ОБЪЕКТОВ
const allIframes = document.querySelectorAll('iframe');

// 3. ОТПРАВКА КОМАНДЫ КАЖДОМУ
if (allIframes.length > 0) {
    // Перебираем все найденные iframe и отправляем каждому одно и то же сообщение
    allIframes.forEach(iframe => {
        iframe.contentWindow.postMessage({
            type: 'startRecordingWithPrompt',
            payload: finalPrompt
        }, '*');
    });
} else {
    // Сообщение об ошибке, если на странице вообще нет веб-объектов
    alert("Критическая ошибка: На слайде не найдено ни одного веб-объекта.");
}